<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Lindy hop moves : a python script that downloads videos and edit them automatically to get a short video for each Lindy Hop dance move of about 5s">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/custom.css">

    <title>Lindy hop moves</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="./javascripts/jquery.csv-0.71.js"></script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/martinGithub/lindy_hop_moves">View on GitHub</a>

          <h1 id="project_title">Lindy hop moves video player</h1>
        
          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" >


<!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
<div id="content"> 
<div id='left'>
<h3 id='title'><h3>  
<div id="player"></div>
 <button type="button"  class='speedButton' speed=1>normal speed</button> 
 <button type="button" class='speedButton' speed=0.5 >slow x2</button> 
 <button type="button" class='speedButton' speed=0.25 >slow x4</button> 
<!--<button type="button" class='BPM'  >click on 1</button>-->
</div>

  <div id='right'>
<div id="listmoves"></div>
</div>
</div>


<!--<table style="width:100%">
  <tr>
    <td><a class='croppedVideo' videoid='-eQaOZXJdkA' start=19 end=30 href='#'>airplane charleston</a></td>
    <td>8 beats</td> 
    <td>level 1</td>
  </tr>
  <tr>
    <td><a   class='croppedVideo'  videoid='HYcuxW5_ilg' start=25 end=31  href='#'>arm catch 8 step </a></td>
    <td>8 beats </td> 
    <td>level 2</td>
  </tr>
</table>-->


<!--
<script src="https://raw.githubusercontent.com/martinGithub/lindy_hop_moves/master/listmoves.js"></script>
 <script>
$(function(){
	
      $("#listmoves").text(moves); 
    });
</script>-->

 <script>
function getSeconds(tt)
{
s=tt.split(":");
sec=s[0]*3600+s[1]*60+s[2]*1;
return sec
}
$.ajax({
  dataType: "json",
  url: 'https://api.github.com/repos/martinGithub/lindy_hop_moves/contents/lindy_moves.csv?ref=listmoves',
    success: function(json) {       
//$("#listmoves").text('worked?'); 
var listmoves=$.csv.toArrays(atob(json.content));
var text='<table style="width:100%">  <tr>'
for	(index = 0; index < listmoves.length; index++) {
	move=listmoves[index]
	text+= '<tr>'
    	text +=   "<td><a class='croppedVideo' videoid='"+move[0]+"' start="+move[1]+" end="+move[2]+" href='#'>"+move[5]+"</a></td>"
   	text +=    "<td>"+move[3]+"</td> "
	text +=    "<td>"+move[4]+"</td> "
	text+='</tr>'
  }
text+=  "</tr></table> "
	$("#listmoves").html(text); 
        $('a.croppedVideo').on("click", function (e) {
	e.preventDefault();

	player.loadVideoById($(this).attr('videoid'));
	maxtime=getSeconds($(this).attr('end'));
	mintime=getSeconds($(this).attr('start'));
	console.log($(this).attr('videoid')+ ' '+ mintime+ ' '+mintime)
	$("#title").html($(this).text()); 
	player.seekTo(mintime, 0);
	idbeat=1
	});

console.log(json)
    },
    error: function(e) {
       console.log(e.message);
    }
});


</script>






    <script>

	videoId='Oi1BcouEmio'//black video

	var maxtime = 20; 
	var mintime = 10; 
	var idbeat=1
console.log(window.location.href)
// find documentation here https://developers.google.com/youtube/iframe_api_reference
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          videoId: videoId,
	  playerVars : {
            'autoplay' : 0, 'controls': 1},
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
	var reached = false;
      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
console.log('ready')

	player.seekTo(mintime, 0);
player.pauseVideo();
	//player.setPlaybackRate(0.3);

	
	var interval = setInterval(function(){
	console.log(player.getCurrentTime())
	//console.log(mintime)
	//console.log(maxtime)

	if(player.getCurrentTime() < maxtime){reached= false;}
	    if((player.getCurrentTime() >= maxtime || player.getCurrentTime() < mintime) &&!reached) {
		console.log('coucou')
		//clearInterval(interval);
		reached = true;
		timeReached(event);
	    }
	},100);
        //event.target.playVideo();

      }

      function onPlayerStateChange(event) {
        if (event.data == 1) {
         



         
        }
      }
	function timeReached(event){
	console.log('time reached')
	//player.pauseVideo();
	event.target.seekTo(mintime, true);// you need to set true or it won't work ! 
	console.log(player.getCurrentTime())
	//player.playVideo();
	idbeat=1
	$('button.BPM').text('click on beat '+idbeat)

	}


      function stopVideo() {
        player.stopVideo();
      }



    $(document).ready(function() {

        $('button.speedButton').on("click", function (e) {
	e.preventDefault();
	player.setPlaybackRate($(this).attr('speed'));
	});

        $('button.BPM').on("click", function (e) {
	e.preventDefault();
	idbeat=idbeat+1
	console.log(player.getCurrentTime())
	$(this).text('click on beat '+idbeat)
	});
    });

$(window).scroll(function(){
    $("#left").css("margin-top",Math.max(-190,0-$(this).scrollTop()));
     
});

    </script>



     
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Lindy hop moves maintained by <a href="https://github.com/martinGithub">martinGithub</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
